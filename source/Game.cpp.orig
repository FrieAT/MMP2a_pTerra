#include "Game.h"

#include <iostream>
#include <memory>

#include <SFML/Audio.hpp>
#include <SFML/Graphics.hpp>

Game::Game()
{
    // Create the main window
    window = new sf::RenderWindow(sf::VideoMode(800, 600), "SFML window");
    
    // Set the Icon
    icon = new sf::Image();
    if (!icon->loadFromFile("assets/icon.png"))
    {
        throw new std::runtime_error("Unable to load assets/icon.png");
    }
    window->setIcon(icon->getSize().x, icon->getSize().y, icon->getPixelsPtr());
}

Game::~Game()
{
    
}

void Game::Start()
{
<<<<<<< HEAD
	// Play the music
	music.play();
	
	ObjectManager::AddGameObject(new PlayerShip());

=======
    IGameState* gamestate;
    
    if(states.empty()) return;
    
    gamestate = states.back();
    
>>>>>>> bbe472d7177e13f70ee98b94a685f599460064ad
	// Start the game loop
    while (window->isOpen())
	{
		// Clear screen
        window->clear();

<<<<<<< HEAD
		// Draw the sprite
		window->draw(*sprite);

		// Manager updates...
		EventManager::Update(window);
		FrameManager::Update(window);
		InputManager::Update(window);
		ObjectManager::Update(window);
=======
        // Call Update in game state
        gamestate->Update(*window);
>>>>>>> bbe472d7177e13f70ee98b94a685f599460064ad

		// Update the window
        window->display();
	}
}

void Game::ChangeState(IGameState* state)
{
<<<<<<< HEAD
	//delete window;
	//delete sprite;
=======
    // cleanup the current state
    if ( !states.empty() ) {
        delete states.back();
        states.pop_back();
    }
    
    // store and init the new state
    states.push_back(state);
>>>>>>> bbe472d7177e13f70ee98b94a685f599460064ad
}